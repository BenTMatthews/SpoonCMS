function BuildContainer(n){let t={};t.Id=n;t.Active=!0;t.Name=$("#containerDetails .containerName .containerNameBlock").first().text();let i={};return $("#containerDetailsAttributes .contentDetailsBlock").each(function(){let t=$(this).data("item-id"),n=BuildContentItem(t);i[n.Name]=n}),t.Items=i,t}function BuildContentItem(n){let t={},r=$(".contentDetailsBlock[data-item-id='"+n+"']").first();t.Id=n;t.Active=!0;t.Name=$(r).find(".contentName .containerItemName").first().text();t.Priority=$("#containerItems .itemBlock .contentPriority").first().text();let i=CKEDITOR.instances[n];return i.updateElement(),t.Value=i.getData(),t}function UpdatePriorityCounts(){$("#containerItemsAccordion .group").each(function(n){$(this).find("h3.itemName .itemPriority").html(n+1)})}function Guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}function S4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function UpdateContainerList(n){$.ajax({type:"GET",url:_basePath+"/GetContainers",success:function(t){if(containers=JSON.parse(t),containers.Success){$("#containerList").html("");let t=$("#container-list-template").html(),i=Handlebars.compile(t);Handlebars.registerPartial("contentBlock-partial",$("#contentBlock-partial").html());Handlebars.registerPartial("contentDetails-partial",$("#contentDetails-partial").html());let r=i(containers.Data);$("#containerList").append(r);n&&$("#containerList .containerItem[data-container-id='"+n+"']").click()}else toastr.error(containers.Message)},error:function(n){toastr.error(n)}})}function SaveContainer(n,t){$.ajax({type:"POST",url:_basePath+"/SaveContainer?id="+n,data:JSON.stringify(t),success:function(n){data=JSON.parse(n);data.Success?toastr.success("Container saved!"):toastr.error(data.Message)},error:function(n){toastr.error(n)}})}function SaveContentItem(n,t){$.ajax({type:"POST",url:_basePath+"/SaveContentItem?id="+n,data:JSON.stringify(t),success:function(n){data=JSON.parse(n);data.Success?toastr.success(t.Name+" saved!"):toastr.error(data.Message)},error:function(n){toastr.error(n)}})}function AddContainer(){let n=$("#formContainerName").val();$.ajax({type:"POST",url:_basePath+"/CreateContainer?name="+n,data:"",success:function(n){data=JSON.parse(n);data.Success?(toastr.success("Container created!"),$("#formContainerName").val(""),UpdateContainerList()):toastr.error(data.Message)},error:function(n){toastr.error(n);$("#formContainerName").val()}})}function LoadContainer(n){$.ajax({type:"GET",url:_basePath+"/GetContainer?id="+n,success:function(n){if(container=JSON.parse(n),container.Success){$("#containerDetails").html("");let n=$("#container-details-template").html(),t=Handlebars.compile(n),i=t(container.Data);$("#containerDetails").append(i);CKEDITOR.replaceAll("htmlEditBox");for(name in CKEDITOR.instances)CKEDITOR.instances[name].config.allowedContent=!0;UpdatePriorityCounts();$("#containerItems").children(".itemBlock:not(.addItem)").first().trigger("click")}else toastr.error(container.Message)},error:function(n){toastr.error(n)}})}function DeleteContainer(n){$.ajax({type:"POST",url:_basePath+"/DeleteContainer?name="+n,data:"",success:function(n){data=JSON.parse(n);data.Success?(toastr.success("Container delted!"),$("#containerDetails").html(""),UpdateContainerList()):toastr.error(data.Message)},error:function(n){toastr.error(n);$("#formContainerName").val()}})}function UpdateContainerName(n,t){$.ajax({type:"POST",url:_basePath+"/EditContainerName?id="+n+"&name="+t,data:"",success:function(n){data=JSON.parse(n);data.Success?(toastr.success("Container name updated!"),$("#containerDetailsAttributes #containerName").html(t),UpdateContainerList()):toastr.error(data.Message)},error:function(n){toastr.error(n);$("#formContainerName").val()}})}function UpdateItemName(n){let t=$("#containerItemsAccordion").find("h3.itemName[data-item-id='"+n+"'] span.itemNameSpan");t.html($("#formItemName").val());$("#formItemName").value=""}var _basePath="[!CustomPathMarker!]",containerAddDialog,containerAddDialogForm,containerEditDialog,containerEditDialogForm,itemNameDialog,itemNameDialogForm;$(document).ready(function(){toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-center",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};UpdateContainerList();$(document).on("click",".containerItem",function(){let n=$(this).data("container-id");$("#containerList .containerItem").removeClass("selected");$(this).addClass("selected");LoadContainer(n)});$(document).on("click","#containerListOptions button.addContainer",function(){containerAddDialog.dialog("open")});$(document).on("click","#containerDetails button.saveContainer",function(){let n=$(this).data("container-id"),t=BuildContainer(n);SaveContainer(n,t)});$(document).on("click","#containerDetailsAttributes .contentDetailsBlock .contentSaveBlock button.saveItem",function(){let n=$(this).data("container-id"),t=$(this).data("item-id"),i=BuildContentItem(t);SaveContentItem(n,i)});$(document).on("click",".itemBlock:not(.addItem)",function(){let n=$(this).data("item-id");$(".contentDetailsBlock").hide();$(".contentDetailsBlock[data-item-id='"+n+"']").show();$("#containerItems .itemBlock").removeClass("active");$(this).addClass("active")});$(document).on("click","#containerItems .itemBlock.addItem",function(){let i=$("#contentDetails-partial").html(),r=Handlebars.compile(i),u=$("#contentBlock-partial").html(),f=Handlebars.compile(u),n={};n.Name="New Item";n.Id=Guid();n.value="";let e=r(n),o=f(n);$("#containerDetailsAttributes").append(e);CKEDITOR.replace(n.Id).config.allowedContent=!0;$("#containerItems").append(o);let t=$(this).data("container-id"),s=$("#containerList .containerItem[data-container-id='"+t+"']").first().text();$(".contentDetailsBlock[data-item-id='"+n.Id+"'] .contentName .containerName").text(s);$(".contentDetailsBlock[data-item-id='"+n.Id+"'] .contentSaveBlock button.saveItem").attr("data-container-id",t);UpdatePriorityCounts();$("#containerItems .itemBlock[data-item-id='"+n.Id+"']").trigger("click")});$(document).on("click","#containerDetails .contentDetailsBlock .contentName i.editContentName",function(){let n=$(this).data("item-id"),t=$(".contentDetailsBlock[data-item-id='"+n+"'] .contentName .containerItemName").first().text();$("#dialog-itemName #editItemNameSave").attr("data-content-id",n);$("#dialog-itemName #formItemName").val(t);$("#dialog-itemName").modal();$("#dialog-itemName #formItemName").focus()});console.log("SpoonCMS admin page ready!")});