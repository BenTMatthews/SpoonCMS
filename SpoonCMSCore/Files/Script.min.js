function AddItemToContainer(){let i=$("#contentDetails-partial").html(),r=Handlebars.compile(i),u=$("#contentBlock-partial").html(),f=Handlebars.compile(u),n={};n.Name="New Item";n.Id=Guid();n.value="";let e=r(n),o=f(n);$("#containerDetailsAttributes").append(e);CKEDITOR.replace(n.Id).config.allowedContent=!0;CKEDITOR.instances[n.Id].config.autoParagraph=!1;$("#containerItems").append(o);let t=$(this).attr("data-container-id"),s=$("#containerList .containerItem[data-container-id='"+t+"']").first().text();$(".contentDetailsBlock[data-item-id='"+n.Id+"'] .contentName .containerName").text(s);$(".contentDetailsBlock[data-item-id='"+n.Id+"'] .contentSaveBlock button.saveItem").attr("data-container-id",t);UpdatePriorityCounts();$("#containerItems .itemBlock[data-item-id='"+n.Id+"']").trigger("click")}function RemoveItemFromContainer(n){$("#containerDetailsAttributes .contentDetailsBlock[data-item-id='"+n+"']").remove();$("#containerItems .itemBlock[data-item-id='"+n+"']").remove();$("#containerItems").children(".itemBlock").first().trigger("click")}function UpdateItemName(n){let t=$("#dialog-itemName #formItemName").val();$(".contentDetailsBlock[data-item-id='"+n+"'] .contentName .containerItemName").first().text(t);$("#containerItems .itemBlock[data-item-id='"+n+"'] .itemContentBlock").first().text(t);$.modal.close();toastr.success('Content name changed to "'+t+'"')}function BuildContainer(n){let t={};t.Id=n;t.Active=!0;t.Name=$("#containerDetails #containerName .containerNameBlock").first().text();let i={},r=!0;return $("#containerItems .itemBlock").each(function(){let t=$(this).attr("data-item-id"),n=BuildContentItem(t);if(n.Name in i)return toastr.error("Content Items must have unique names"),r=!1,!1;i[n.Name]=n}),r?(t.Items=i,t):!1}function BuildContentItem(n){let t={},r=$(".contentDetailsBlock[data-item-id='"+n+"']").first();t.Id=n;t.Active=!0;t.Name=$(r).find(".contentName .containerItemName").first().text();t.Priority=$("#containerItems .itemBlock .contentPriority").first().text();let i=CKEDITOR.instances[n];return i.updateElement(),t.Value=i.getData(),t}function UpdatePriorityCounts(){$("#containerDetails #containerItems .itemBlock").each(function(n){$(this).find(".contentPriority").text(n+1)})}function Guid(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}function S4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function UpdateContainerList(n){$.ajax({type:"GET",url:_basePath+"/GetContainers",success:function(t){if(containers=JSON.parse(t),containers.Success){$("#containerList").html("");let t=$("#container-list-template").html(),i=Handlebars.compile(t);Handlebars.registerPartial("contentBlock-partial",$("#contentBlock-partial").html());Handlebars.registerPartial("contentDetails-partial",$("#contentDetails-partial").html());let r=i(containers.Data);$("#containerList").append(r);n&&($("#containerList .containerItem").removeClass("selected"),$("#containerList .containerItem[data-container-name='"+n+"']").addClass("selected"))}else toastr.error(containers.Message)},error:function(n){toastr.error(n)}})}function SaveContainer(n,t){$.ajax({type:"POST",url:_basePath+"/SaveContainer?id="+n,data:JSON.stringify(t),success:function(n){data=JSON.parse(n);data.Success?toastr.success("Container saved!"):toastr.error(data.Message)},error:function(n){toastr.error(n)}})}function SaveContentItem(n,t){$.ajax({type:"POST",url:_basePath+"/SaveContentItem?id="+n,data:JSON.stringify(t),success:function(n){data=JSON.parse(n);data.Success?toastr.success(t.Name+" saved!"):toastr.error(data.Message)},error:function(n){toastr.error(n)}})}function AddContainer(n){$.ajax({type:"POST",url:_basePath+"/CreateContainer?name="+n,data:"",success:function(n){data=JSON.parse(n);data.Success?(toastr.success("Container created!"),$("#formContainerName").val(""),UpdateContainerList(),$.modal.close()):toastr.error(data.Message)},error:function(n){toastr.error(n);$("#formContainerName").val()}})}function LoadContainer(n){$.ajax({type:"GET",url:_basePath+"/GetContainer?id="+n,success:function(n){if(container=JSON.parse(n),container.Success){$("#containerDetails").html("");let n=$("#container-details-template").html(),i=Handlebars.compile(n),r=i(container.Data);$("#containerDetails").append(r);CKEDITOR.replaceAll("htmlEditBox");for(name in CKEDITOR.instances)CKEDITOR.instances[name].config.allowedContent=!0,CKEDITOR.instances[name].config.autoParagraph=!1;UpdatePriorityCounts();var t=document.getElementById("containerItems");Sortable.create(t,{draggable:".itemBlock",onUpdate:function(){UpdatePriorityCounts()}});$("#containerItems").children(".itemBlock").first().trigger("click")}else toastr.error(container.Message)},error:function(n){toastr.error(n)}})}function DeleteContainer(n){$.ajax({type:"POST",url:_basePath+"/DeleteContainer?name="+n,data:"",success:function(n){data=JSON.parse(n);data.Success?(toastr.success("Container delted!"),$("#containerDetails").html(""),UpdateContainerList(),$.modal.close()):toastr.error(data.Message)},error:function(n){toastr.error(n);$("#formContainerName").val()}})}function UpdateContainerName(n,t){$.ajax({type:"POST",url:_basePath+"/EditContainerName?id="+n+"&name="+t,data:"",success:function(n){data=JSON.parse(n);data.Success?(toastr.success("Container name updated!"),$("#containerDetails #containerName .containerNameBlock").first().text(t),UpdateContainerList(t),$.modal.close()):toastr.error(data.Message)},error:function(n){toastr.error(n);$("#formContainerName").val()}})}var _basePath="[!CustomPathMarker!]",containerAddDialog,containerAddDialogForm,containerEditDialog,containerEditDialogForm,itemNameDialog,itemNameDialogForm;$(document).ready(function(){toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-center",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};$(document).on("click","#containerList .containerItem",function(){let n=$(this).attr("data-container-id");$("#containerList .containerItem").removeClass("selected");$(this).addClass("selected");LoadContainer(n)});$(document).on("click","#containerList .containerItem i.deleteContainer",function(){if(confirm("Are you sure you want to delete this container and all items?")==!0){let n=$(this).attr("data-container-name");DeleteContainer(n)}});$(document).on("click","#containerListOptions button.addContainer",function(){containerAddDialog.dialog("open")});$(document).on("click","#containerDetails button.saveContainer",function(){let n=$(this).attr("data-container-id"),t=BuildContainer(n);t!=!1&&SaveContainer(n,t)});$(document).on("click","#containerDetailsAttributes .contentDetailsBlock .contentSaveBlock i.saveItem",function(){let n=$(this).attr("data-container-id"),t=$(this).attr("data-item-id"),i=BuildContentItem(t);SaveContentItem(n,i)});$(document).on("click","#containerItems .itemBlock",function(){let n=$(this).attr("data-item-id");$(".contentDetailsBlock").hide();$(".contentDetailsBlock[data-item-id='"+n+"']").show();$("#containerItems .itemBlock").removeClass("active");$(this).addClass("active")});$(document).on("click","#containerItems .addItem",function(){AddItemToContainer()});$(document).on("click","#containerDetailsAttributes .contentDetailsBlock .contentName .deleteItemBlock i.deleteItem",function(){if(confirm("Are you sure you want to delete this item from the container?")==!0){let n=$(this).attr("data-item-id");RemoveItemFromContainer(n)}});$(document).on("click","#containerDetails .contentDetailsBlock .contentName i.editContentName",function(n){n.preventDefault();let t=$(this).attr("data-item-id"),i=$(".contentDetailsBlock[data-item-id='"+t+"'] .contentName .containerItemName").first().text();$("#dialog-itemName form").attr("data-item-id",t);$("#dialog-itemName #formItemName").val(i);$("#dialog-itemName").modal();$("#dialog-itemName #formItemName").select()});$(document).on("click","#dialog-itemName #editItemNameSave",function(){$("#dialog-itemName form").submit()});$("#dialog-itemName form").submit(function(n){n.preventDefault();let t=$(this).attr("data-item-id");UpdateItemName(t)});$(document).on("click","#containerDetails #containerName i.editContainerName",function(n){n.preventDefault();let t=$(this).attr("data-container-id"),i=$("#containerDetails #containerName .containerNameBlock").first().text();$("#dialog-nameContainer form").attr("data-container-id",t);$("#dialog-nameContainer #formEditContainerName").val(i);$("#dialog-nameContainer").modal();$("#dialog-nameContainer #formEditContainerName").select()});$(document).on("click","#dialog-nameContainer #editContainerNameSave",function(){$("#dialog-nameContainer form").submit()});$("#dialog-nameContainer form").submit(function(n){n.preventDefault();let t=$(this).attr("data-container-id"),i=$("#dialog-nameContainer #formEditContainerName").val();UpdateContainerName(t,i)});$(document).on("click","#containerList #containerListOptions #addContainer",function(n){n.preventDefault();$("#dialog-addContainer").modal();$("#dialog-addContainer #formContainerName").val("Container name");$("#dialog-addContainer #formContainerName").select()});$(document).on("click","#dialog-addContainer #addContainerAdd",function(){$("#dialog-addContainer form").submit()});$("#dialog-addContainer form").submit(function(n){n.preventDefault();let t=$("#dialog-addContainer #formContainerName").val();AddContainer(t)});UpdateContainerList();console.log("SpoonCMS admin page ready!")});